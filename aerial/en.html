---
title: Beijing City Aerial History
description: Among imagery, slide time to erase civilization
img: https://www.momentbeijing.com/aerial/assets/aerial_banner_1999.gif
layout: map
---


<div id="map"></div>
<script>

// read url params
var params = {};
window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
  params[key] = value;
});


/* **** Leaflet **** */
// bound
var bigbounds = [[39.86, 116.45],[39.96, 116.33]];

// base layers
var layer_bw = L.tileLayer('http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png', 
        {attribution: '', 
        });

var layer_bing = new L.BingLayer('AsaKzgbo2GW8wrcv0mLCyVvEx2Q8V1N54Gpmizw-fzHIKOAjAMMy4TdNfKdS71vs', 
        {minNativeZoom:13, 
        bounds:bigbounds,
        maxZoom: 20,
        })

var layer_bw_overlay = L.tileLayer('http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png', 
        {attribution: '', 
        opacity: 0.5, 
        });

var layer_osmb = new OSMBuildings(map).load('https://{s}.data.osmbuildings.org/0.2/anonymous/tile/{z}/{x}/{y}.json');
    layer_osmb.style({wallColor:'rgba(37, 3, 1, 0.8)', 
        roofColor:'rgba(244, 67, 54, 0.01)', 
        shadows:false, 
        zoomOffset: 4,
        minNativeZoom:10,
        })

// aerial layers
var jsdelivr_cdn = 'https://cdn.jsdelivr.net/gh/momentbeijing/momentbeijing.github.io/aerial/tiles/'
var map_zxy = '/{z}/{x}/{y}.png'
var smallbounds = [[39.86572446735752, 116.44348887780663],[39.954196820860616, 116.33614726486017]];
function makesidelayer(year){
    return L.tileLayer(jsdelivr_cdn+year+map_zxy, {
        tms: true, 
        attribution: year, 
        maxNativeZoom:17, 
        minNativeZoom:13, 
        maxZoom: 19,
        bounds: smallbounds,
        });
}
var layer_1938_left = makesidelayer(1938)
var layer_1938_right = makesidelayer(1938)
var layer_1959_left = makesidelayer(1959)
var layer_1959_right = makesidelayer(1959)
var layer_1999_left = makesidelayer(1999)
var layer_1999_right = makesidelayer(1999)
var layer_2011_left = makesidelayer(2011)
var layer_2011_right = makesidelayer(2011)
var layer_2020_left = new L.tileLayer('') 
var layer_2020_right = new L.tileLayer('')


//pass url params: https://blog.mastermaps.com/2012/10/how-to-control-your-leaflet-map-with.html
var years = ['1938','1959','1999','2011','2020']
if (years.includes(params.year)) {
  var layer_param_left = 'layer_'+params.year+'_left'
} else {
    layer_param_left = 'layer_1999_left'
}

// leaflet map
var map = L.map('map', {
        center: [parseInt(params.lat)||39.90988365647943,parseInt(params.lon)|| 116.38964525311975],
        zoom: 1,
        minZoom: 12,
        maxZoom: 19,
        layers: [layer_bw, layer_bing, layer_2020_right, eval(layer_param_left)],
        attributionControl: false,
        zoomControl: false,
        });

// share
var src = '<a target="_blank" rel="noopener noreferrer" href="{{ site.url }}" style="text-decoration:none; text-align:inherit">&copy Moment of Beijing - Murder of the City</a><div class="social-share" data-source="" data-title="{{ page.title }}" data-description="{{ page.description }}" data-image="{{ page.img }}" data-wechat-qrcode-title="Scan WeChat QR" data-wechat-qrcode-helper="" data-sites="weibo,wechat,douban,qq,twitter,facebook" data-mobile-sites="weibo,twitter"><a target="_blank" rel="noopener noreferrer" href="mailto:{{site.email}}" class="social-share-icon icon-mail">M</a></div>';
var title = L.control({position: 'bottomleft'});
title.onAdd = function(map) {
    this._div = L.DomUtil.create('div', 'ctl src');
    this.update();
    return this._div;
    };
title.update = function(props) {
    this._div.innerHTML = src;
    };
title.addTo(map);

// title
var title = L.control({position: 'bottomleft'});
title.onAdd = function(map) {
    this._div = L.DomUtil.create('div', 'ctl title');
    this.update();
    return this._div;
    };
title.update = function(props) {
    this._div.innerHTML = '<a rel="noopener noreferrer" href="{{ site.url }}/aerial-doc.html" style="text-decoration:none; color:black;">{{ page.title }}</a>';
    };
title.addTo(map);

// selection panel
var basemaps_left = {
    "1938": layer_1938_left,
    "1959": layer_1959_left,
    "1999": layer_1999_left,
    "2011": layer_2011_left, 
    "2020": layer_2020_left,
    }
var basemaps_right = {
    "1938": layer_1938_right,
    "1959": layer_1959_right,
    "1999": layer_1999_right,
    "2011": layer_2011_right, 
    "2020": layer_2020_right,
    }
var overlaymaps = {
    "Rd+Bldg":L.layerGroup([layer_osmb, layer_bw_overlay])
    }
// Add base layers
L.control.layers(
    basemaps_right, 
    overlaymaps,
    {collapsed: false,
    position:'topright',
    },).addTo(map);
L.control.layers(
    basemaps_left, 
    overlaymaps,
    {collapsed: false, 
    position:'topleft',
    },).addTo(map);

L.control.sideBySide(Object.values(basemaps_left),Object.values(basemaps_right)).addTo(map);

// search widget
var bingGeocoder = new L.Control.BingGeocoder('AsaKzgbo2GW8wrcv0mLCyVvEx2Q8V1N54Gpmizw-fzHIKOAjAMMy4TdNfKdS71vs');
map.addControl(bingGeocoder);

if (params.q) {
  bingGeocoder._input.value=decodeURIComponent(params.q);
  bingGeocoder._geocode_initial()
} else {
setTimeout(function(){map.zoomIn(1);},2000);
}

//language link
var title = L.control({position: 'bottomright'});
title.onAdd = function(map) {
    this._div = L.DomUtil.create('div', 'ctl title');
    this.update();
    return this._div;
    };
title.update = function(props) {
    this._div.innerHTML = '<a rel="noopener noreferrer" href="{{ site.url }}/aerial/index.html" style="text-decoration:none; color:black;">文</a>';
    };
title.addTo(map);

//looplayer
function clicklayer(i){
    document.getElementsByClassName('leaflet-control-layers-selector')[i].click();
}

function addyearcap(){
    var yearcap = document.createElement('div');
    yearcap.id = 'yearcap';
    yearcap.innerHTML = '';
    yearcap.style.color = 'white';
    yearcap.style.zIndex = '1000';
    yearcap.style.position = 'absolute';
    yearcap.style.fontSize = '10vw';
    yearcap.style.top = '85%';
    yearcap.style.left = '50%';
    yearcap.style.transform = 'translate(-50%, -50%) scalex(1.5)';
    yearcap.style.textShadow = '0 0 20px black';
    yearcap.style.letterSpacing = '2vw';
    document.body.appendChild(yearcap);
}

function changeyearcap(i){
    document.getElementById('yearcap').innerHTML = '-'+Object.keys(basemaps_left)[i]+'-'
}

function removeyearcap(){
    document.getElementById('yearcap').remove()
}


function looplayer(i){
    if (i == 0){
        clicklayer(i);
        addyearcap()
        changeyearcap(i);
        i++;
        looplayer(i);
    } else if (i < Object.keys(basemaps_left).length){
        setTimeout(function(){
            clicklayer(i);
            changeyearcap(i);
            i++;
            looplayer(i);
        },3000);
    } else {
        setTimeout(function(){
        removeyearcap();
        },3000);
    }
}

var title = L.control({position: 'bottomright'});
title.onAdd = function(map) {
    this._div = L.DomUtil.create('div', 'ctl title');
    this.update();
    return this._div;
    };
title.update = function(props) {
    this._div.innerHTML = '<a rel="noopener noreferrer" href="#" onclick="looplayer(0);" style="text-decoration:none; color:black;">⏳</a>';
    };
title.addTo(map);

// L.easyButton('<span>GIF</span>', function(){
//     looplayer(0);
// }).addTo(map);

</script>